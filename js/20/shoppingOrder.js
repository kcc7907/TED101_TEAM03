let buy=document.querySelector(".buy"),title=document.querySelectorAll(".title");title[1].classList.add("-onColor"),creditCartTypes={VI:[new RegExp("^4[0-9]{12}([0-9]{3})?$"),new RegExp("^[0-9]{3}$"),!0],MC:[new RegExp("^(?:5[1-5][0-9]{2}|222[1-9]|22[3-9][0-9]|2[3-6][0-9]{2}|27[01][0-9]|2720)[0-9]{12}$"),new RegExp("^[0-9]{3}$"),!0],JCB:[new RegExp("^35(2[8-9]|[3-8])\\d*$"),new RegExp("^[0-9]{3}$"),!0]};let left2=new Vue({el:"#left2",data:{members:[],memName:"",memLives:"",memCity:"",cardBox:!1,remit:!1,addressBox:!1,freight:!1,selected:"居住縣市",cardmix:"",formData:{fname:"",memid:"",fphone:"",fcity:"",fadd:"",payment:"",total:0,discount:0,products:[]}},methods:{focus(e){e.target.closest("div").querySelector("input").disabled=!1,e.target.closest("div").querySelector("input").focus()},blur(e){e.target.closest("div").querySelector("input").disabled=!0},cardCode(e){e.which>=48&&e.which<=57||8==e.which||37==e.which||39==e.which||e.which>=96&&e.which<=105?e.target.value.length>2&&8!==e.which&&e.preventDefault():e.preventDefault()},cardNum(e){let t=this.$refs;8==e.which||(e.which>=48&&e.which<=57||37==e.which||39==e.which||e.which>=96&&e.which<=105?(4===t.cardnum1.value.length&&t.cardnum2.focus(),4===t.cardnum2.value.length&&t.cardnum3.focus(),4===t.cardnum3.value.length&&t.cardnum4.focus(),4===t.cardnum4.value.length&&e.preventDefault(),this.cardmix=t.cardnum1.value+t.cardnum2.value+t.cardnum3.value+t.cardnum4.value):e.preventDefault())},cardDate(e){e.target.value.length>3&&8!==e.which&&e.preventDefault(),e.which>=48&&e.which<=57||8==e.which||37==e.which||39==e.which||e.which>=96&&e.which<=105||e.preventDefault()},phoneInput(e){10==e.target.value.length&&8!==e.which&&e.preventDefault(),e.which>=48&&e.which<=57||8==e.which||37==e.which||39==e.which||e.which>=96&&e.which<=105||e.preventDefault()},changAddr(){}},created(){let e=getCookie("loging");axios.post("../php/20/getMember.php",{ID:e}).then(e=>{this.members=e.data,this.memLives=e.data[0].MEM_CITY+e.data[0].MEM_ADDRESS,this.memCity=e.data[0].MEM_CITY,this.formData.fphone=e.data[0].MEM_PHONE,this.formData.fname=e.data[0].MEM_NAME,this.formData.memid=getCookie("loging")})},watch:{cardmix(){if(16===this.cardmix.length){let e=creditCartTypes.VI[0].test(""+this.cardmix),t=creditCartTypes.MC[0].test(""+this.cardmix),a=creditCartTypes.JCB[0].test(""+this.cardmix);e&&this.$refs.imgV.style.setProperty("filter","grayscale(0%)"),t&&this.$refs.imgM.style.setProperty("filter","grayscale(0%)"),a&&this.$refs.imgJ.style.setProperty("filter","grayscale(0%)")}else this.$refs.imgV.style.setProperty("filter","grayscale(100%)"),this.$refs.imgM.style.setProperty("filter","grayscale(100%)"),this.$refs.imgJ.style.setProperty("filter","grayscale(100%)")},cardBox(){!0===this.cardBox&&(this.remit=!1,this.area="已付款",this.formData.payment="已付款")},remit(){!0===this.remit&&(this.cardBox=!1,this.formData.payment="未付款")},freight(){if(!0===this.freight)switch(this.addressBox=!1,this.formData.fcity=this.members[0].MEM_CITY,this.formData.fadd=this.members[0].MEM_ADDRESS,this.memCity){case"台北市":case"新北市":case"桃園市":right.Shipping=2e3;break;case"基隆市":case"新竹市":case"新竹縣":case"宜蘭縣":right.Shipping=3e3;break;case"苗栗縣":case"台中市":case"彰化縣":case"南投縣":case"雲林縣":case"嘉義市":case"嘉義縣":case"花蓮縣":right.Shipping=4e3;break;case"台南市":case"高雄市":case"屏東縣":case"台東縣":right.Shipping=5e3}else right.Shipping=0},addressBox(){!0===this.addressBox?(this.freight=!1,right.Shipping=0,this.formData.fadd=""):right.Shipping=0},selected(){switch(this.formData.fcity=this.selected,this.selected){case"台北市":case"新北市":case"桃園市":right.Shipping=2e3;break;case"基隆市":case"新竹市":case"新竹縣":case"宜蘭縣":right.Shipping=3e3;break;case"苗栗縣":case"台中市":case"彰化縣":case"南投縣":case"雲林縣":case"嘉義市":case"嘉義縣":case"花蓮縣":right.Shipping=4e3;break;case"台南市":case"高雄市":case"屏東縣":case"台東縣":right.Shipping=5e3}}}}),right=new Vue({el:"#right",data:{total:0,discount:0,Shipping:0,final:0,proTotal:0},methods:{backCart(){pop.text="是否返回購物車?",pop.show=!0,pop.confirm="backCart"},totalPrice(){this.final=this.total+this.discount+this.Shipping},sendCheck(){let e=left2.$refs,t=!1,a=0,i=document.querySelectorAll("input");if(!1===t){if(document.querySelector(".freight_city").classList.remove("input_erro"),i.forEach(e=>{e.classList.contains("input_erro")&&e.classList.remove("input_erro")}),""==e.rname.value&&e.rname.classList.add("input_erro"),""==e.rphone.value&&e.rphone.classList.add("input_erro"),""==e.raddr.value&&e.raddr.classList.add("input_erro"),1==left2.cardBox){document.querySelectorAll(".card_box input").forEach(e=>{""==e.value&&e.classList.add("input_erro")})}1==left2.addressBox&&(""==e.rfaddr.value&&e.rfaddr.classList.add("input_erro"),"居住縣市"==left2.selected&&(document.querySelector(".freight_city").classList.add("input_erro"),a++)),i.forEach(e=>{e.classList.contains("input_erro")&&a++}),1==left2.freight&&1==left2.remit?t=!0:0!=a||1!=left2.addressBox&&1!=left2.freight||1!=left2.cardBox&&1!=left2.remit?(pop.text="請正確填寫資料",pop.show=!0):t=!0}!0===t&&(pop.text="是否確認完成訂單?",pop.show=!0,pop.confirm="sendData")},sendData(){let e=JSON.parse(localStorage.getItem("lists"));left2.formData.products=e,axios.post("../php/20/sendData.php",left2.formData).then(e=>{localStorage.setItem("orderNum",e.data),localStorage.setItem("total",this.final),left2.remit&&localStorage.setItem("payment","匯款"),left2.cardBox&&localStorage.setItem("payment","信用卡")}).then(()=>location.href="shoppingdone.php")}},mounted(){let e=JSON.parse(localStorage.getItem("lists"));e||(this.proTotal=e.length),this.discount=parseInt(localStorage.getItem("discount")),e.forEach((e,t)=>{this.total+=parseInt(e.prd_price),this.proTotal+=parseInt(e.num)}),this.final=this.total+this.discount,left2.formData.discount=this.discount},watch:{Shipping(){this.final=this.total+this.discount+this.Shipping},final(){left2.formData.total=this.final}}});